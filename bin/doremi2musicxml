#!/usr/bin/env node
var path = require('path');
var fs = require('fs');
var lib = path.join(path.dirname(fs.realpathSync(__filename)), '../lib');

var filename = process.argv[2];
if (filename) {
  var cwd=process.cwd();
  var filepath = path.join(cwd, filename);
  var source=fs.readFileSync(filepath, 'utf8')
} else {
var source= fs.readFileSync('/dev/stdin').toString()
}
_console = require(lib+'/doremi-script-base/underscore.logger.js') 
_console.level  = _console.constructor.WARN
_ = require("underscore")._ 
_.mixin(_console.toObject())

require(lib+'/doremi-script-base/doremi_script_parser.js')
var to_musicxml=require(lib+'/doremi-script-base/to_musicxml.js').to_musicxml
var parser=DoremiScriptParser
var composition=parser.parse(source)
composition.source=source
process.stdout.write(to_musicxml(composition)+"\n")
